from typing import List, Union
from stix2 import Malware as stixMalware, Relationship, DomainName
from zerofox.domain import Malware


def malware_to_malware(entry: Malware) -> List[Union[stixMalware, Relationship]]:
    malware = stixMalware(
        name=f"Malware -- {entry.sha256}",
        labels=entry.tags,
        created=entry.created_at,
        malware_types="unknown",
        is_family=False,
    )
    domain_names = [DomainName(value=c2) for c2 in entry.c2]
    malware_families = [Malware(name=family, is_family=True)
                        for family in entry.family]

    return (
        [malware]
        + [
            Relationship(source=malware.id, target=domain_name.id,
                         relationship_type="communicates-with")
            for domain_name in domain_names
        ]
        + [
            Relationship(source=malware.id, target=family.id,
                         relationship_type="variant-of")
            for family in malware_families
        ]
    )
